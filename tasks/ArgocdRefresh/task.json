{
    "id": "b2c3d4e5-6f7a-890b-cdef-012345678901",
    "name": "ArgocdRefresh",
    "friendlyName": "ArgoCD Application Refresh",
    "description": "Refresh an ArgoCD application with comprehensive status monitoring and health validation",
    "helpMarkDown": "This task refreshes an ArgoCD application to detect changes from Git, monitors sync operations, validates application health, and checks for error/warning conditions. Provides intelligent handling of Unknown sync status and manifest errors. [More Information](https://argo-cd.readthedocs.io/en/stable/user-guide/auto_sync/)",
    "category": "Deploy",
    "author": "vburca",
    "demands": [],
    "version": {
        "Major": "1",
        "Minor": "2",
        "Patch": "7"
    },
    "minimumAgentVersion": "2.144.0",
    "instanceNameFormat": "ArgoCD Refresh: $(applicationName)",
    "icon": "icon.png",
    "groups": [
        {
            "name": "connection",
            "displayName": "Connection",
            "isExpanded": true
        },
        {
            "name": "application",
            "displayName": "Application",
            "isExpanded": true
        },
        {
            "name": "refresh",
            "displayName": "Refresh Options",
            "isExpanded": true
        },
        {
            "name": "advanced",
            "displayName": "Advanced",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "argoCDConnection",
            "type": "connectedService:vburca-argocd",
            "label": "ArgoCD Service Connection",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the ArgoCD service connection. Configure this in Project Settings > Service Connections.",
            "groupName": "connection"
        },
        {
            "name": "project",
            "type": "pickList",
            "label": "Project (Optional)",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "ArgoCD project name. If specified, only applications from this project will be shown in the Application dropdown.",
            "groupName": "application",
            "properties": {
                "EditableOptions": "True"
            }
        },
        {
            "name": "applicationName",
            "type": "pickList",
            "label": "Application Name",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "The ArgoCD application to refresh. The dropdown is populated based on the selected project.",
            "groupName": "application",
            "properties": {
                "EditableOptions": "True"
            }
        },
        {
            "name": "hardRefresh",
            "type": "boolean",
            "label": "Hard Refresh",
            "defaultValue": "false",
            "required": false,
            "helpMarkDown": "Perform a hard refresh to force cache invalidation and fetch the latest state from Git.",
            "groupName": "refresh"
        },
        {
            "name": "waitForChanges",
            "type": "boolean",
            "label": "Wait for auto-sync if changes detected",
            "defaultValue": "true",
            "required": false,
            "helpMarkDown": "If changes are detected and the application has auto-sync enabled, wait for the sync to complete.",
            "groupName": "refresh"
        },
        {
            "name": "terminateRunningSync",
            "type": "boolean",
            "label": "Terminate running sync before refresh",
            "defaultValue": "false",
            "required": false,
            "helpMarkDown": "If a sync operation is already running, terminate it before performing the refresh. Use with caution in production environments.",
            "groupName": "refresh"
        },
        {
            "name": "syncTimeout",
            "type": "string",
            "label": "Auto-sync Timeout (seconds)",
            "defaultValue": "300",
            "required": false,
            "helpMarkDown": "Maximum time to wait for auto-sync completion. Only applies if 'Wait for auto-sync' is enabled and changes are detected.",
            "groupName": "refresh",
            "visibleRule": "waitForChanges = true"
        },
        {
            "name": "failOnWarnings",
            "type": "boolean",
            "label": "Fail on Warning Conditions",
            "defaultValue": "false",
            "required": false,
            "helpMarkDown": "Fail the task if the application has warning conditions. When disabled, warnings are logged but don't fail the task.",
            "groupName": "advanced"
        },
        {
            "name": "failOnDegraded",
            "type": "boolean",
            "label": "Fail on Degraded Health",
            "defaultValue": "true",
            "required": false,
            "helpMarkDown": "Fail the task if the application health status is 'Degraded'. Recommended for production environments.",
            "groupName": "advanced"
        },
        {
            "name": "failOnUnknown",
            "type": "boolean",
            "label": "Fail on Unknown Sync Status",
            "defaultValue": "false",
            "required": false,
            "helpMarkDown": "Fail the task if the application sync status is 'Unknown'. Unknown status often indicates manifest errors or configuration issues.",
            "groupName": "advanced"
        }
    ],
    "dataSourceBindings": [
        {
            "target": "applicationName",
            "endpointId": "$(argoCDConnection)",
            "dataSourceName": "ArgoCDApplications",
            "parameters": {
                "project": "$(project)"
            }
        },
        {
            "target": "project",
            "endpointId": "$(argoCDConnection)",
            "dataSourceName": "ArgoCDProjects"
        }
    ],
    "execution": {
        "Node10": {
            "target": "index.js"
        },
        "Node16": {
            "target": "index.js"
        },
        "Node20": {
            "target": "index.js"
        }
    }
}